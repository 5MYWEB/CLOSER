<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.closer.model.mapper.FeedMapper">

    <!-- DB엔 update_at 컬럼있는데 피드는 수정 기능없어서 뺐습니다. 추후 feed DB에서 update_at 컬럼 삭제해야 함-->
    <insert id="feedWrite" parameterType="feedDto">
        insert into feed (feed_pk, userId, title, content, create_at, location)
        values (#{feed_pk}, #{userId}, #{title}, #{content}, #{create_at}, #{location})
    </insert>

    <!-- CLOSER 전체 유저의 피드 목록 -->
    <select id="feedListAll" resultType="FeedDto">
        select feed_pk, userId, title, content, created_at, updated_at, location
        from feed
    </select>

    <!-- 나와 동일한 위치인 사람들의 피드 목록 -->
    <select id="feedListNear" parameterType="String" resultType="FeedDto">
        select feed_pk, userId, title, content, created_at, updated_at, location
        from feed
        where location = #{location}
    </select>

    <!-- 내가 팔로우 한 사람들의 피드 목록 -->
    <select id="feedListFollow" parameterType="String" resultType="FeedDto">
        select feed_pk, userId, title, content, created_at, updated_at, location
        from user_follow U
                 left join feed F
                           on (U.passiveUser = F.userId)
        where U.activeUser=#{passiveUser}
    </select>


    <!-- 피드 생성 -->
    <insert id="createFeed" parameterType="FeedDto">
        insert into feed(userId, content, location)
        values (#{userId}, #{content}, #{location})
    </insert>

    <!-- 피드 조회 -->
    <select id="readFeed" parameterType="int" resultType="FeedDto">
        select * from feed
        where feed_pk = #{feed_pk}
    </select>

    <!-- 피드 수정 -->
    <update id="feedUpdate" parameterType="FeedDto">
        update feed
        set content=#{content}
        where feed_pk = #{feed_pk}
    </update>

    <!-- 피드 삭제 -->
    <delete id="deleteFeed" parameterType="int">
        delete from feed
        where feed_pk = #{feed_pk}
    </delete>

</mapper>